services:
  ros2-turbovnc-novnc:
    build:
      context: .
      args:
        INSTALL_PACKAGE: desktop # or 'ros-base' for leaner
    image: ros2-turbovnc-novnc:jazzy-fixed-v2
    container_name: ros2-turbovnc-novnc
    environment:
      USER: ubuntu
      PASSWORD: change-me
      VNC_GEOMETRY: 1600x900
      VNC_DEPTH: "24"
      VNC_PORT: "5901"
      NO_VNC_PORT: "6080"
      # Stability helpers (also set in image)
      QT_X11_NO_MITSHM: "1"
      LIBGL_DRI3_DISABLE: "1"
      # LIBGL_ALWAYS_SOFTWARE: "1"  # enable only if needed
      RMW_IMPLEMENTATION: rmw_cyclonedds_cpp
      ROS_DOMAIN_ID: "7"
      ROS_AUTOMATIC_DISCOVERY_RANGE: LOCALHOST
    ports:
      - "8080:6080" # noVNC browser
      - "5901:5901" # TurboVNC viewer
    volumes:
      - ./ros2_ws:/home/ubuntu/ros2_ws
    shm_size: "2gb"
    tty: true
